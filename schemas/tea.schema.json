{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$title": "Tea Recipe Schema",
  "type": "object",
  "required": ["tea_recipes"],
  "properties": {
    "tea_recipes": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["recipe_id", "display_name", "intent", "target_need", "allowed_times", "base_liquid", "ingredients", "steps", "serves", "repeatable"],
        "properties": {
          "recipe_id": {
            "type": "string",
            "pattern": "^[a-z0-9_]+$"
          },
          "display_name": {
            "type": "string",
            "minLength": 1
          },
          "intent": {
            "type": "string",
            "minLength": 1,
            "description": "Narrative intent (comfort, clarity, calm, gratitude...)"
          },
          "target_need": {
            "type": "string",
            "minLength": 1,
            "description": "Player_Need_Satisfied phrasing"
          },
          "allowed_times": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["Morning", "Afternoon", "Evening", "Night", "Any"]
            },
            "minItems": 1
          },
          "base_liquid": {
            "type": "string",
            "enum": ["water", "milk", "oat_milk"]
          },
          "ingredients": {
            "type": "array",
            "minItems": 2,
            "maxItems": 7,
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": ["ingredient_ref", "role", "amount_hint"],
              "properties": {
                "ingredient_ref": {
                  "type": "string",
                  "description": "ingredient_id OR a substitution token like any:tag=calming&category=Herb. All ingredient references in Tea recipes must resolve to ingredients with safety_category = generally_safe."
                },
                "role": {
                  "type": "string",
                  "enum": ["base", "note", "sweetener", "garnish", "focus", "support"]
                },
                "amount_hint": {
                  "type": "string",
                  "minLength": 1
                }
              }
            }
          },
          "tools": {
            "type": "array",
            "items": { "type": "string" },
            "default": []
          },
          "steps": {
            "type": "array",
            "minItems": 2,
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "sensory_prompt": {
            "type": ["string", "null"],
            "default": null
          },
          "outcome_tags": {
            "type": "array",
            "items": { "type": "string" },
            "default": []
          },
          "serves": {
            "type": "integer",
            "minimum": 1,
            "maximum": 4
          },
          "repeatable": {
            "type": "string",
            "enum": ["Always", "Limited", "Once"]
          },
          "unlocks": {
            "type": "array",
            "items": { "type": "string" },
            "default": []
          },
          "notes": {
            "type": ["string", "null"],
            "default": null
          }
        }
      }
    }
  }
}